<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>IPTV è¬èƒ½æª¢æŸ¥å·¥å…·</title>
    <style>
        body { background-color: #2c3e50; color: white; font-family: sans-serif; padding: 20px; }
        .card { background: #34495e; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        textarea { width: 100%; height: 150px; background: #ecf0f1; border: none; border-radius: 5px; padding: 10px; box-sizing: border-box; }
        .console { background: #1e1e1e; color: #00ff00; padding: 15px; height: 300px; overflow-y: scroll; border-radius: 5px; font-family: 'Courier New', Courier, monospace; margin-top: 15px; border: 1px solid #555; }
        button { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background: #2ecc71; }
        .status-tag { font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“¡ IPTV æ’­æ”¾æºæ‰¹é‡æ·±åº¦æª¢æŸ¥</h2>
    <p>æ ¼å¼ï¼šé »é“åç¨±,ç¶²å€ (æ¯è¡Œä¸€å€‹)</p>
    <textarea id="iptvList" placeholder="æ±æ£®æ–°è,http://..."></textarea>
    <br>
    <button onclick="startBatchCheck()">ğŸš€ é–‹å§‹æ‰¹é‡æª¢æŸ¥ (é€£å‹•æœ¬åœ°å¼•æ“)</button>

    <div class="console" id="logWindow">ç­‰å¾…ä»»å‹™å•Ÿå‹•...</div>
</div>

<script>
    async function startBatchCheck() {
        const logWindow = document.getElementById('logWindow');
        const listText = document.getElementById('iptvList').value.trim();
        
        if (!listText) {
            alert("è«‹å…ˆè²¼ä¸Šæ’­æ”¾æºæ¸…å–®ï¼");
            return;
        }

        const lines = listText.split('\n');
        logWindow.innerHTML = "=== æ­£åœ¨é€£ç·šæœ¬åœ°å¼•æ“... ===\n";

        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line || !line.includes(',')) continue;

            const [name, url] = line.split(',');
            logWindow.innerHTML += `[${i+1}/${lines.length}] æ­£åœ¨åˆ†æ: ${name}...\n`;
            logWindow.scrollTop = logWindow.scrollHeight;

            try {
                // å‘¼å«ä½ å‰›æ‰è·‘èµ·ä¾†çš„æœ¬åœ° Python (127.0.0.1:5000)
                const response = await fetch('http://127.0.0.1:5000/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, url: url })
                });

                const result = await response.json();
                logWindow.innerHTML += `${result.msg}\n`;
            } catch (error) {
                logWindow.innerHTML += `âŒ éŒ¯èª¤: ç„¡æ³•é€£ç·šè‡³æœ¬åœ°å¼•æ“ã€‚è«‹ç¢ºèª Python è¦–çª—æœªé—œé–‰ä¸”å·²å®‰è£ flask-corsã€‚\n`;
                break; // åœæ­¢å¾ŒçºŒæª¢æŸ¥
            }
            logWindow.scrollTop = logWindow.scrollHeight;
        }
        logWindow.innerHTML += "\nâœ… æ‰¹é‡æª¢æŸ¥ä»»å‹™å®Œæˆï¼";
    }
</script>

</body>
</html>